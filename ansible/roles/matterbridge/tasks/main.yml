---

- name: Create {{ matterbridge_path }} dir
  file:
    path: "{{ matterbridge_path }}"
    state: directory

- name: Template matterbridge config
  template:
    src: matterbridge.toml.j2
    dest: "{{ matterbridge_path }}/matterbridge.toml"
  notify: restart matterbridge

- name: Deploy matterbridge
  docker_compose:
    project_name: matterbridge
    definition:
      version: '2'
      services:
        matterbridge:
          image: "{{ matterbridge_image }}"
          restart: always
          environment:
            PRODUCTION: "TRUE"
          volumes:
            - "{{ matterbridge_path }}/matterbridge.toml:/matterbridge.toml"
